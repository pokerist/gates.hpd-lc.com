{% extends "base.html" %}
{% block content %}
<section class="card hero">
  <h2>Manual Debug (فحص يدوي)</h2>
  <p>رفع صورة أو التقاطها للمعاينة فقط.</p>
</section>

<section class="grid grid-2">
  <div class="card">
    <div class="camera-container">
      <video id="debugCamera" autoplay playsinline></video>
      <canvas id="debugCanvas" class="hidden" hidden></canvas>
      <div class="camera-frame">
        <div class="frame-box"></div>
      </div>
    </div>
    <div style="margin-top: 14px; display: flex; gap: 10px; flex-wrap: wrap;">
      <button class="btn btn-primary" id="debugCaptureBtn">التقاط</button>
      <button class="btn btn-secondary" id="debugSwitchBtn">تبديل الكاميرا</button>
      <label class="btn btn-outline">
        رفع صورة
        <input id="debugFileInput" type="file" accept="image/*" capture="environment" hidden />
      </label>
    </div>
  </div>

  <div class="card">
    <h3>صورة البطاقة المقصوصة</h3>
    <div style="margin-top: 12px;">
      <img id="debugImage" alt="debug" style="width:100%; border-radius: 14px; border: 1px solid rgba(255,255,255,0.1); display:none;" />
    </div>
    <div class="grid grid-2" style="margin-top: 16px;">
      <div>
        <h4 style="margin-bottom: 8px;">الصورة المُرسلة لـ Document AI</h4>
        <img id="debugDocaiImage" alt="docai" style="width:100%; border-radius: 14px; border: 1px solid rgba(255,255,255,0.1); display:none;" />
      </div>
      <div>
        <h4 style="margin-bottom: 8px;">صورة الوجه المستخرجة</h4>
        <img id="debugFaceImage" alt="face" style="width:100%; border-radius: 14px; border: 1px solid rgba(255,255,255,0.1); display:none;" />
      </div>
    </div>
    <div class="debug-accordion">
      <details class="accordion">
        <summary>النتيجة النهائية</summary>
        <div id="debugFinal" class="field-list"></div>
      </details>
      <details class="accordion">
        <summary>Tesseract</summary>
        <div id="debugTess" class="field-list"></div>
      </details>
      <details class="accordion">
        <summary>Document AI (كل الحقول)</summary>
        <div id="debugDocai" class="field-list"></div>
      </details>
      <details class="accordion">
        <summary>زمن التنفيذ</summary>
        <div id="debugTimings" class="field-list"></div>
      </details>
      <details class="accordion">
        <summary>الحقول المكتشفة</summary>
        <div id="debugFields" class="field-list"></div>
      </details>
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
<script src="/static/js/debug.js"></script>
{% endblock %}
